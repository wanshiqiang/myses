<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Ses——课堂教室模型2</title>
    <script src="/static/js/jquery-3.2.1.min.js"></script>


    <link rel="stylesheet" href="/static/css/jquery-ui.min.css">
    <script src="/static/js/jquery-ui.min.js"></script>
    <script src="/static/js/jquery.ui.touch-punch.min.js"></script>

    <script>
        $(document).ready(function(){

          $(".students" ).draggable({revert:true , delay:3000});
          <!--$(".students" ).droppable({-->
             <!--drop: function(event, ui) {-->
                <!--seat1 = ui.draggable.children("div[class='stuseat']").text();-->
                <!--seat2 = $(this).children("div[class='stuseat']").text();-->
                <!--selectCla = $("select[name=selectCla] option[selected]").val();-->
                <!--selectSub = $("select[name=selectSub] option[selected]").val();-->
                <!--&lt;!&ndash;alert( "被拖动drop的学生座位号"+seat1+"被放置drop的学生座位号："+seat2 +"班级"+selectCla +"学科"+selectSub);&ndash;&gt;-->
                <!--$.ajax({-->
                            <!--url: "/ses/changeSeat/?seat1="+seat1+"&seat2="+seat2+"&selectCla="+selectCla+"&selectSub="+selectSub,-->
                            <!--type:'GET',-->
                            <!--dataType:'json',-->
                            <!--success: function(data){-->
                                <!--&lt;!&ndash;alert(data);&ndash;&gt;-->
                                <!--$.each(data,function(i,n){-->
                                    <!--&lt;!&ndash;alert(n)&ndash;&gt;-->
                                    <!--window.location.reload();-->
                                <!--})-->
                            <!--}-->
                       <!--})-->
             <!--}-->
          <!--});-->


          $(".students").click(function(){
             scoreDiv = $(this).children("div[class='stuscore']");
             selectCla = $("select[name=selectCla] option[selected]").val();
             selectSub = $("select[name=selectSub] option[selected]").val();
             selectScoreRule = $("select[name=selectScoreRule] option[selected]").val();
             studentNO = $(this).children('div.stunumber').text();
             var type_edit_score = $('#edit_div input[name="editScore"]:checked ').val();
             <!--是因为ie的缓存做的不好，为了防止ajax不停的提交，有时候会不执行，直接返回。当传递的参数值相同时ajax会不执行。-->
             <!--所以解决办法就是传递一个参数保证每次执行的时候参数值不同就行，所以可以加一个随机函数，或者加一个时间戳就可以了。-->
             var time = new Date();
            <!--alert(type_edit_score)-->

             <!--url = "/ses/editScore?studentNO="+studentNO+"&selectCla="+selectCla+"&selectSub="+selectSub;-->
             <!--alert(url);-->

              $.ajax({
                        url:"/ses/editScore?studentNO="+studentNO+"&selectCla="+selectCla+"&selectSub="+selectSub+"&selectScoreRule="+selectScoreRule+"&type="+type_edit_score+"&time="+time,
                        type:'GET',
                        dataType:'json',
                        success :function(data){
                            <!--alert(data.score);-->
                            <!--alert(scoreDiv.text());-->
                            scoreDiv.text(data.score);
                        }
                    });

             <!--if(type_edit_score == 1){-->
                    <!--$.ajax({-->
                        <!--url:"/ses/editScore?studentNO="+studentNO+"&selectCla="+selectCla+"&selectSub="+selectSub+"&type="+type_edit_score,-->
                        <!--type:'GET',-->
                        <!--dataType:'json',-->
                        <!--success:function(data){-->
                                <!--&lt;!&ndash;alert(data);&ndash;&gt;-->
                            <!--$.each(data,function(i,n){-->
                                    <!--&lt;!&ndash;alert(n)&ndash;&gt;-->
                                <!--window.location.reload();-->
                            <!--});-->
                        <!--}-->
                    <!--});-->
             <!--}else{-->
                    <!--$.ajax({-->
                        <!--url:"/ses/minusScore?studentNO="+studentNO+"&selectCla="+selectCla+"&selectSub="+selectSub,-->
                        <!--type:'GET',-->
                        <!--dataType:'json',-->
                        <!--success:function(data){-->
                                <!--&lt;!&ndash;alert(data);&ndash;&gt;-->
                            <!--$.each(data,function(i,n){-->
                                    <!--&lt;!&ndash;alert(n)&ndash;&gt;-->
                                <!--window.location.reload();-->
                            <!--});-->
                        <!--}-->
                    <!--});-->
             <!--}-->



          });



          <!--$(".students").on("click",function(){-->
             <!--scoreDiv = $(this).children("div[class='stuscore']");-->
             <!--selectCla = $("select[name=selectCla] option[selected]").val();-->
             <!--selectSub = $("select[name=selectSub] option[selected]").val();-->
             <!--selectScoreRule = $("select[name=selectScoreRule] option[selected]").val();-->
             <!--studentNO = $(this).children('div.stunumber').text();-->
             <!--var type_edit_score = $('#edit_div input[name="editScore"]:checked ').val();-->
             <!--&lt;!&ndash;是因为ie的缓存做的不好，为了防止ajax不停的提交，有时候会不执行，直接返回。当传递的参数值相同时ajax会不执行。&ndash;&gt;-->
             <!--&lt;!&ndash;所以解决办法就是传递一个参数保证每次执行的时候参数值不同就行，所以可以加一个随机函数，或者加一个时间戳就可以了。&ndash;&gt;-->
             <!--var time = new Date();-->
            <!--&lt;!&ndash;alert(type_edit_score)&ndash;&gt;-->

             <!--&lt;!&ndash;url = "/ses/editScore?studentNO="+studentNO+"&selectCla="+selectCla+"&selectSub="+selectSub;&ndash;&gt;-->
             <!--&lt;!&ndash;alert(url);&ndash;&gt;-->

              <!--$.ajax({-->
                        <!--url:"/ses/editScore?studentNO="+studentNO+"&selectCla="+selectCla+"&selectSub="+selectSub+"&selectScoreRule="+selectScoreRule+"&type="+type_edit_score+"&time="+time,-->
                        <!--type:'GET',-->
                        <!--dataType:'json',-->
                        <!--success :function(data){-->
                            <!--&lt;!&ndash;alert(data.score);&ndash;&gt;-->
                            <!--&lt;!&ndash;alert(scoreDiv.text());&ndash;&gt;-->
                            <!--scoreDiv.text(data.score);-->
                        <!--}-->
                    <!--});-->
          <!--});-->

          $(".students").dblclick(function(){
            //alert($(this).attr("id"));
            <!--$("#selected2").text($(this).children('div.stuname').text())-->
          });


          $("#edit_seat").click(function(){
            selectCla = $("select[name=selectCla] option[selected]").val();
            selectSub = $("select[name=selectSub] option[selected]").val();
            window.location.replace("/ses/editSeat/?selectCla="+selectCla+"&selectSub="+selectSub);
          });


          $(".editScore").change(function() {
            var type_edit_score = $('#edit_div input[name="editScore"]:checked ').val();
            if (type_edit_score==1){
                $('stuscore').css({'border':'1px green solid','position':'absolute','left':'50px','top':'30px'});
                <!--alert('green');-->
                <!--$('stuscore').css("border","1px #123 solid");-->
            }else{
                <!--alert('red');-->
                $('stuscore').css({'border':'1px red solid','position':'absolute','left':'50px','top':'30px'});
            }
          });

          $('#selectCla').change(function(){
                var selectClaID=$(this).children('option:selected').val();//这就是selected的值
                var selectSubID=$('#selectSub').val();
                //window.location.href="xx.php?param1="+p1+"¶m2="+p2+"";//页面跳转并传参
                $.ajax({
                    url : encodeURI("/ses/getScoreRules?selectCla="+selectClaID+"&selectSub="+selectSubID),
                    type : 'GET',
                    dataType : "json",
                    success : function(scoreRules) {
                        var selectScoreRule =$(document).find("#selectScoreRule");
                        selectScoreRule.empty();

                        //$.each($.parseJSON(scoreRules), function(idx, obj) {
                        //    alert(obj.scoreRule__title);
                        //});
                        //不需要解析就可以使用了
                        $.each(scoreRules, function(idx, obj) {
                            //alert(obj.scoreRule__title);
                            selectScoreRule.append("<option value='"+obj.scoreRule__id+"'>"+ obj.scoreRule__title+ "</option>");
                        });
                        //$('#selectScoreRule').trigger('change');
                    }
                });
          });

          $('#selectSub').change(function(){
                var selectClaID=$('#selectCla').val();;//这就是selected的值
                var selectSubID=$('#selectSub').val();
                //window.location.href="xx.php?param1="+p1+"¶m2="+p2+"";//页面跳转并传参
                $.ajax({
                    url : encodeURI("/ses/getScoreRules?selectCla="+selectClaID+"&selectSub="+selectSubID),
                    type : 'GET',
                    dataType : "json",
                    success : function(scoreRules) {
                        var selectScoreRule =$(document).find("#selectScoreRule");
                        selectScoreRule.empty();

                        //$.each($.parseJSON(scoreRules), function(idx, obj) {
                        //    alert(obj.scoreRule__title);
                        //});
                        //不需要解析就可以使用了
                        $.each(scoreRules, function(idx, obj) {
                            //alert(obj.scoreRule__title);
                            selectScoreRule.append("<option value='"+obj.scoreRule__id+"'>"+ obj.scoreRule__title+ "</option>");
                        });
                        //$('#selectScoreRule').trigger('change');
                    }
                });
          });

        });

    </script>
<!--792px120px-->
    <style type="text/css">
        #classroom{
            width:80%;
            max-width:792px;
            height:640px;
            border:1px solid green;
            position:relative;
            top:30px;
            margin:0 auto;
            clear:left;
            <!--clear:right;-->

        }

        div[id^='stu']{
            width : 15%;
            height : 60px;
            border:1px solid #666;
            border-radius: 5px;
            box-shadow:4px 4px 6px #666;
            margin:0.6%;
            padding:0.6%;
            float:left;

        }
        div[id^='stu']:active{
            border-color:green;
            box-shadow:4px 4px 6px green;
        }
        .stunumber{
            display:none;
        }

        .stuname{
            position:absolute;
            left:40%;
            font-size: 1vw;
        }

        .stuseat{
            position:absolute;
            left:25%;
            font-size: 1vw;

        }
        .isheadman{
            position:absolute;
            left:5%;
            top:50%;
            font-size: 1vw;
        }

        .stuscore{
            border: 1px green solid;
            position:absolute;
            left:40%;
            top:50%;
            font-size: 1vw;
        }


        #selectCla_Sub{
            position:relative;
            top:50px;
            width:792px;
            display:block;
            margin:0 auto;
            <!--border: 1px red solid;-->
        }

        #selectCla_form{
            position:absolute;
            left:0px;
            <!--border: 1px blue solid;-->
        }
        #selectCla_form2{
            position:absolute;
            left:240px;
            <!--border: 1px blue solid;-->
        }

        #edit_div{
            position:absolute;
            top:0px;
            right:0px;
            <!--left:660px;-->
            <!--border: 1px blue solid;-->
            <!--top:60px;-->
            <!--left:1150px;-->
        }
        .editScore{
            <!--float:left;-->
            <!--position:absolute;-->
            <!--left:0px;-->
            <!--top:0px;-->
            <!--border: 1px blue solid;-->
            float:left;
        }

        #edit_seat{
            <!--float:left;-->
        }


    </style>


    <!-- Bootstrap -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


</head>
<body>
<!-- Main jumbotron for a primary marketing message or call to action -->
{% include "ses/top_navigation.html"%}
<!--<h3 align="center">教室模型</h3>-->

<!--<h5 align="center">交换座位：请选择两个不同的学生</h5>-->
<!--<div align="center" id="selected1">请选择两个学生</div>-->
<!--<div align="center" id="selected2">请选择两个学生</div>-->


<div id="selectCla_Sub" >
    <form id="selectCla_form" action="/ses/searchSeat" method="get">
        班级
        <select name="selectCla" id="selectCla">
            <!--<OPTION VALUE="1">宝马-->
            <!--<OPTION VALUE="2">保时捷-->
            <!--<OPTION VALUE="3" SELECTED>大奔-->
            {% for classroom in classrooms%}
            {% ifequal selectClassroomID classroom.id %}
            <OPTION VALUE={{classroom.id}} selected>{{classroom.name}}

                {% else %}
            <OPTION VALUE={{classroom.id}}>{{classroom.name}}

                {% endifequal %}
                {% endfor %}
        </select>

        学科
        <select name="selectSub" id="selectSub">
            {% for subject in subjects%}
            {% ifequal selectSubjectID subject.id %}
            <OPTION VALUE={{subject.id}} selected>{{subject.name}}
                {% else %}
            <OPTION VALUE={{subject.id}}>{{subject.name}}
                {% endifequal %}
                {% endfor %}
        </select>
        评价标准
        <select name="selectScoreRule" id="selectScoreRule">
            {% for scoreRule in scoreRules%}
            {% ifequal selectedScoreRuleID scoreRule.0 %}
            <OPTION VALUE={{scoreRule.0}} selected>{{scoreRule.1}}
                {% else %}
            <OPTION VALUE={{scoreRule.0}}>{{scoreRule.1}}
                {% endifequal %}
                {% endfor %}
        </select>
        <input type="submit" value="确定">
    </form>
    <div id ="edit_div">
        <input type="radio" name="editScore" value="1" class="editScore" checked="checked">加分</input>
        <input type="radio" name="editScore" value="2" class="editScore">减分</input>
        <input type="button" id="edit_seat" value="排序"></input>
    </div>

</div>


<!--<div class="container">class="col-md-2"-->
<div id="classroom">
    {% for seatByRowCol in seatListByRowCol%}



    <div id="stu{{forloop.counter}}" class="students">

        <div class="stunumber">
            {{seatByRowCol.seat.student.number}}
        </div>
        <div class="stuseat">
            {{seatByRowCol.seat.student.stuNO}}
        </div>
        <div class="stuname">
            {{seatByRowCol.seat.student.name}}
        </div>
        <div id="row{{forloop.counter}}" style="border: 1px blue solid;">
            {{seatByRowCol.rowIndex}}
        </div>
        <div id="col{{forloop.counter}}" style="border: 1px blue solid;">
            {{seatByRowCol.colIndex}}
            <br>{{seatByRowCol.seat.seatNo}}
        </div>

        <div class="isheadman">
            {% ifequal seat.student.isHeadman 1 %}
                ★
            {% endifequal %}
        </div>


        {% for score in scores%}
            {% ifequal seatByRowCol.seat.student.id score.student.id %}
                <div class="stuscore">
                    {{score.score}}
                </div>
            {% endifequal %}
        {% endfor %}

    </div>
    {% endfor %}


</div>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>-->

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/static/js/bootstrap.min.js"></script>

</body>
</html>